<% return unless turbo_frame_request_id == "pagination_frame" %>

<%= turbo_stream.append "feed" do %>
  <% @posts.each do |post| %>
    <li class="feed-item">
      <%= render 'posts/post', post: post %>
    </li>
  <% end %>
<% end %>

<%= turbo_stream.replace "pagination-footer" do %>
  <div id="pagination-footer">
    <% if @pagy.next %>
      <%= turbo_frame_tag "pagination_frame", 
          src: infinite_scroll_load_more_url(@pagy, @city, @observed_subject), 
          loading: :lazy do %>
        <div class="text-center p-4 text-muted">読み込み中...</div>
      <% end %>
    <% else %>
      <div class="text-center p-4 text-muted small">すべての投稿を読み込みました</div>
    <% end %>
  </div>
<% end %>
